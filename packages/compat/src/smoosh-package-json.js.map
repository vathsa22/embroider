{"version":3,"file":"smoosh-package-json.js","sourceRoot":"","sources":["smoosh-package-json.ts"],"names":[],"mappings":";;;;;AAAA,sEAAqC;AAErC,2BAA6D;AAC7D,+BAA4B;AAC5B,qCAAyC;AAEzC,MAAqB,iBAAkB,SAAQ,yBAAM;IACnD,YAAY,UAAkB,EAAE,OAAgC,EAAE;QAChE,KAAK,CAAC,UAAU,EAAE;YAChB,UAAU,EAAE,sCAAsC,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,UAAU,EAAE;YACpE,gBAAgB,EAAE,IAAI;YACtB,UAAU,EAAE,KAAK;SAClB,CAAC,CAAC;IACL,CAAC;IAED,KAAK;QACH,IAAI,IAAI,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;YACjC,IAAI,OAAO,GAAG,IAAA,WAAI,EAAC,CAAC,EAAE,cAAc,CAAC,CAAC;YACtC,IAAI,IAAA,eAAU,EAAC,OAAO,CAAC,EAAE,CAAC;gBACxB,OAAO,IAAI,CAAC,KAAK,CAAC,IAAA,iBAAY,EAAC,OAAO,EAAE,MAAM,CAAC,CAAC,CAAC;YACnD,CAAC;QACH,CAAC,CAAC,CAAC;QACH,IAAI,GAAG,GAAG,IAAA,sBAAa,EAAC,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC;QACrC,IAAA,kBAAa,EAAC,IAAA,WAAI,EAAC,IAAI,CAAC,UAAU,EAAE,cAAc,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC,CAAC,EAAE,MAAM,CAAC,CAAC;IAC7F,CAAC;CACF;AAnBD,oCAmBC","sourcesContent":["import Plugin from 'broccoli-plugin';\nimport type { Node } from 'broccoli-node-api';\nimport { readFileSync, writeFileSync, existsSync } from 'fs';\nimport { join } from 'path';\nimport { mergeWithUniq } from './merges';\n\nexport default class SmooshPackageJSON extends Plugin {\n  constructor(inputTrees: Node[], opts: { annotation?: string } = {}) {\n    super(inputTrees, {\n      annotation: `embroider:core:smoosh-package-json:${opts?.annotation}`,\n      persistentOutput: true,\n      needsCache: false,\n    });\n  }\n\n  build() {\n    let pkgs = this.inputPaths.map(p => {\n      let pkgPath = join(p, 'package.json');\n      if (existsSync(pkgPath)) {\n        return JSON.parse(readFileSync(pkgPath, 'utf8'));\n      }\n    });\n    let pkg = mergeWithUniq({}, ...pkgs);\n    writeFileSync(join(this.outputPath, 'package.json'), JSON.stringify(pkg, null, 2), 'utf8');\n  }\n}\n"]}