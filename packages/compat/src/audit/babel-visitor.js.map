{"version":3,"file":"babel-visitor.js","sourceRoot":"","sources":["babel-visitor.ts"],"names":[],"mappings":"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","sourcesContent":["import type { NodePath, Node } from '@babel/traverse';\nimport traverse from '@babel/traverse';\nimport type { TransformOptions } from '@babel/core';\nimport { transformSync, types as t } from '@babel/core';\nimport type { SourceLocation } from '@babel/code-frame';\nimport { codeFrameColumns } from '@babel/code-frame';\n\nexport class VisitorState {}\n\nexport interface InternalImport {\n  source: string;\n  codeFrameIndex: number | undefined;\n  specifiers: {\n    name: string | NamespaceMarker;\n    local: string | null; // can be null when re-exporting, because in that case we import `name` from `source` but don't create any local binding for it\n    codeFrameIndex: number | undefined;\n  }[];\n}\n\nexport interface NamespaceMarker {\n  isNamespace: true;\n}\n\nexport function isNamespaceMarker(value: string | NamespaceMarker): value is NamespaceMarker {\n  return typeof value !== 'string';\n}\n\nexport interface ExportAll {\n  all: string;\n}\n\n// babelConfig must include { ast: true }\nexport function auditJS(rawSource: string, filename: string, babelConfig: TransformOptions, frames: CodeFrameStorage) {\n  let imports = [] as InternalImport[];\n  let exports = new Set<string | ExportAll>();\n  let problems = [] as { message: string; detail: string; codeFrameIndex: number | undefined }[];\n\n  /* eslint-disable @typescript-eslint/no-inferrable-types */\n  // These are not really inferrable. Without explicit declarations, TS thinks\n  // they're always false because it doesn't know the handler methods run\n  // synchronously\n  let sawModule: boolean = false;\n  let sawExports: boolean = false;\n  let sawDefine: boolean = false;\n  /* eslint-enable @typescript-eslint/no-inferrable-types */\n\n  let { ast, code } = transformSync(rawSource, Object.assign({ filename: filename }, babelConfig))!;\n  let saveCodeFrame = frames.forSource(rawSource);\n\n  traverse(ast!, {\n    Identifier(path: NodePath<t.Identifier>) {\n      if (path.node.name === 'module' && isFreeVariable(path)) {\n        sawModule = true;\n      } else if (path.node.name === 'exports' && isFreeVariable(path)) {\n        sawExports = true;\n      } else if (path.node.name === 'define' && isFreeVariable(path)) {\n        sawDefine = true;\n      }\n      if (inExportDeclarationContext(path)) {\n        exports.add(path.node.name);\n      }\n    },\n    CallExpression(path: NodePath<t.CallExpression>) {\n      let callee = path.get('callee');\n      if (callee.referencesImport('@embroider/macros', 'importSync') || t.isImport(callee.node)) {\n        let arg = path.node.arguments[0];\n        if (arg.type === 'StringLiteral') {\n          imports.push({\n            source: arg.value,\n            codeFrameIndex: saveCodeFrame(arg),\n            specifiers: [],\n          });\n        } else {\n          problems.push({\n            message: `audit tool is unable to understand this usage of ${\n              t.isImport(callee.node) ? 'import' : 'importSync'\n            }`,\n            detail: arg.type,\n            codeFrameIndex: saveCodeFrame(arg),\n          });\n        }\n      }\n    },\n    ImportDeclaration(path: NodePath<t.ImportDeclaration>) {\n      imports.push({\n        source: path.node.source.value,\n        codeFrameIndex: saveCodeFrame(path.node.source),\n        specifiers: [],\n      });\n    },\n    ImportDefaultSpecifier(path: NodePath<t.ImportDefaultSpecifier>) {\n      imports[imports.length - 1].specifiers.push({\n        name: 'default',\n        local: path.node.local.name,\n        codeFrameIndex: saveCodeFrame(path.node),\n      });\n    },\n    ImportNamespaceSpecifier(path: NodePath<t.ImportNamespaceSpecifier>) {\n      imports[imports.length - 1].specifiers.push({\n        name: { isNamespace: true },\n        local: path.node.local.name,\n        codeFrameIndex: saveCodeFrame(path.node),\n      });\n    },\n    ImportSpecifier(path: NodePath<t.ImportSpecifier>) {\n      imports[imports.length - 1].specifiers.push({\n        name: name(path.node.imported),\n        local: path.node.local.name,\n        codeFrameIndex: saveCodeFrame(path.node),\n      });\n    },\n    ExportDefaultDeclaration(_path: NodePath<t.ExportDefaultDeclaration>) {\n      exports.add('default');\n    },\n    ExportSpecifier(path: NodePath<t.ExportSpecifier>) {\n      exports.add(name(path.node.exported));\n      if (path.parent.type === 'ExportNamedDeclaration' && path.parent.source) {\n        imports[imports.length - 1].specifiers.push({\n          name: name(path.node.local),\n          local: null, // re-exports don't create local bindings\n          codeFrameIndex: saveCodeFrame(path.node),\n        });\n      }\n    },\n    ExportNamespaceSpecifier(path: NodePath<t.ExportNamespaceSpecifier>) {\n      exports.add(name(path.node.exported));\n      if (path.parent.type === 'ExportNamedDeclaration' && path.parent.source) {\n        imports[imports.length - 1].specifiers.push({\n          name: { isNamespace: true },\n          local: null, // re-exports don't create local bindings\n          codeFrameIndex: saveCodeFrame(path.node),\n        });\n      }\n    },\n    ExportAllDeclaration(path: NodePath<t.ExportAllDeclaration>) {\n      exports.add({ all: path.node.source.value });\n      imports.push({\n        source: path.node.source.value,\n        codeFrameIndex: saveCodeFrame(path.node.source),\n        specifiers: [\n          {\n            name: { isNamespace: true },\n            local: null,\n            codeFrameIndex: saveCodeFrame(path.node),\n          },\n        ],\n      });\n    },\n    ExportNamedDeclaration(path: NodePath<t.ExportNamedDeclaration>) {\n      if (path.node.source) {\n        imports.push({\n          source: path.node.source.value,\n          codeFrameIndex: saveCodeFrame(path.node.source),\n          specifiers: [],\n        });\n      }\n    },\n  });\n\n  let isCJS = imports.length === 0 && exports.size === 0 && (sawModule || sawExports);\n  let isAMD = imports.length === 0 && exports.size === 0 && sawDefine;\n  return { imports, exports, isCJS, isAMD, problems, transpiledContent: code! };\n}\n\nexport class CodeFrameStorage {\n  private codeFrames = [] as { rawSourceIndex: number; loc: SourceLocation }[];\n  private rawSources = [] as string[];\n\n  forSource(rawSource: string): (node: { loc?: SourceLocation | null }) => number | undefined {\n    let rawSourceIndex: number | undefined;\n    return (node: { loc?: SourceLocation | null | undefined }) => {\n      let loc = node.loc;\n      if (!loc) {\n        return;\n      }\n      if (rawSourceIndex == null) {\n        rawSourceIndex = this.rawSources.length;\n        this.rawSources.push(rawSource);\n      }\n      let codeFrameIndex = this.codeFrames.length;\n      this.codeFrames.push({\n        rawSourceIndex,\n        loc,\n      });\n      return codeFrameIndex;\n    };\n  }\n\n  render(codeFrameIndex: number | undefined): string | undefined {\n    if (codeFrameIndex != null) {\n      let { loc, rawSourceIndex } = this.codeFrames[codeFrameIndex];\n      return codeFrameColumns(this.rawSources[rawSourceIndex], loc, { highlightCode: true });\n    }\n  }\n}\n\nfunction name(node: t.StringLiteral | t.Identifier): string {\n  if (t.isStringLiteral(node)) {\n    return node.value;\n  } else {\n    return node.name;\n  }\n}\n\nfunction isFreeVariable(path: NodePath<t.Identifier>) {\n  return !path.scope.hasBinding(path.node.name);\n}\n\nconst contextCache: WeakMap<Node, boolean> = new WeakMap();\n\nfunction inExportDeclarationContext(path: NodePath): boolean {\n  if (contextCache.has(path.node)) {\n    return contextCache.get(path.node)!;\n  } else {\n    let answer = _inExportDeclarationContext(path);\n    contextCache.set(path.node, answer);\n    return answer;\n  }\n}\n\nfunction _inExportDeclarationContext(path: NodePath): boolean {\n  let parent = path.parent;\n  switch (parent.type) {\n    case 'ExportNamedDeclaration':\n      return parent.declaration === path.node;\n    case 'VariableDeclaration':\n    case 'ObjectPattern':\n    case 'ArrayPattern':\n    case 'RestElement':\n      return inExportDeclarationContext(path.parentPath!);\n    case 'VariableDeclarator':\n      return parent.id === path.node && inExportDeclarationContext(path.parentPath!);\n    case 'ObjectProperty':\n      return parent.value === path.node && inExportDeclarationContext(path.parentPath!);\n    case 'AssignmentPattern':\n      return parent.left === path.node && inExportDeclarationContext(path.parentPath!);\n    case 'FunctionDeclaration':\n    case 'ClassDeclaration':\n      return parent.id === path.node && inExportDeclarationContext(path.parentPath!);\n    default:\n      return false;\n  }\n}\n"]}